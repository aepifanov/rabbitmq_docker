#!/bin/bash

# Domain name for containers
CONTAINER_DOMAIN=

# Path to the addn-hosts file
CONTAINER_HOSTS="docker.hosts"

# Add hostname and host IP
HOSTNAME=$(hostname)
HOST_IP=$(ifconfig docker0 | awk 'sub(/inet addr:/,""){print $1}')
echo "# Auto-generated by $0" > $CONTAINER_HOSTS
echo "$HOST_IP $HOSTNAME" >> $CONTAINER_HOSTS

# Add dockers hostname and IP
for CID in `docker ps -q`; do
    IP=`docker inspect --format '{{ .NetworkSettings.IPAddress }}' $CID`
    NAME=`docker inspect --format '{{ .Config.Hostname }}' $CID`
    echo "$IP $NAME" >> $CONTAINER_HOSTS
done

# Ask dnsmasq to reload addn-hosts
service dnsmasq restart
